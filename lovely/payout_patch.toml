[manifest]
version = "1.0.0"
dump_lua = true
priority = -1

# Make sure that leet runs after all other possible bonuses
[[patches]]
[patches.pattern]
target = "functions/state_events.lua"
pattern = "if total_cashout_rows > 7 then"
position = "before"
payload = '''
    for _, area in ipairs(SMODS.get_card_areas('jokers')) do
            for _, _card in ipairs(area.cards) do
            local ret = (_card.config.center.key == "j_MDJ_leet")
    
            -- TARGET: calc_dollar_bonus per card
            if ret then
                -- +1 because it should count itself
                ret = _card.ability.extra.add*(total_cashout_rows+1)
                i = i+1
                add_round_eval_row({dollars = ret, bonus = true, name='joker'..i, pitch = pitch, card = _card})
                pitch = pitch + 0.06
                dollars = dollars + ret
            end
        end
    end
'''
match_indent = true

# I'm evil ðŸ˜ˆðŸ˜ˆðŸ˜ˆðŸ˜ˆ
[[patches]]
[patches.pattern]
target = """=[SMODS _ "src/utils.lua"]"""
pattern = "local result = pseudorandom(seed) < numerator / denominator"
position = "at"
payload = '''
local result = pseudorandom(seed) <= numerator / denominator
'''
match_indent = true

# Sprite in description
[[patches]]
[patches.pattern]
target = "functions/misc_functions.lua"
pattern = "elseif part.control.E then"
position = "before"
payload = '''
elseif part.control.IMG then
    local sprite_mod = (part.control.s and tonumber(part.control.s) or 1) * desc_scale
    local atlas = SMODS.get_atlas(part.control.IMG)
    local w_mod = atlas.px / atlas.py
    final_line[#final_line + 1] = {
        n = G.UIT.O,
        config = {
            object = SMODS.create_sprite(0, 0, sprite_mod * w_mod, sprite_mod, atlas, {x = 0, y = 0})
        }
    }
'''
match_indent = true

# Sprite in description box
[[patches]]
[patches.pattern]
target = '=[SMODS _ "src/utils.lua"]'
pattern = "elseif part.control.X or part.control.B then"
position = "before"
payload = '''
elseif part.control.IMG then
    local sprite_mod = (part.control.s and tonumber(part.control.s) or 1) * desc_scale
    local atlas = SMODS.get_atlas(part.control.IMG)
    local w_mod = atlas.px / atlas.py
    final_line[#final_line + 1] = {
        n = G.UIT.O,
        config = {
            object = SMODS.create_sprite(0, 0, sprite_mod * w_mod, sprite_mod, atlas, {x = 0, y = 0})
        }
    }
'''
match_indent = true
